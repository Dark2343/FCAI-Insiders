<!DOCTYPE html>

<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../CSS/Vacation.css" />
    <link rel="stylesheet" href="../CSS/Navigation.css" />
    <title>Vacation Application Form</title>
    <script>

      function validate(vac) {
        // Check if id is a number
        if (vac.id == "" || vac.id == undefined) {
          alert("Error: Please write a valid ID");
          return false;
        
        }

        // Checking if the name exists
        if (vac.name == "" || vac.name == undefined) {
          alert("Error: Please enter a name");
          return false;
        }


        // Checking if the dates are valid
        var today = new Date();
        var beginDate = vac.beginDate;
        var endDate = vac.endDate;
        if (beginDate < today) {
          alert("Error: Begin date must be in the future");
          return false;
        }
        if (endDate < today) {
          alert("Error: End date must be in the future");
          return false;
        }
        if (endDate < beginDate) {
          alert("Error: End date must be after begin date");
          return false;
        }

        // Checking if the reason exists
        if (vac.reason == "" || vac.reason == undefined) {
          alert("Error: Please enter a reason");
          return false;
        }
        return true;
      }


      function submitVacForm() {
        var vac = {
          id: document.getElementById("empID").value,
          name: document.getElementById("empName").value,
          beginDate: document.getElementsByName("beginDate")[0].value,
          endDate: document.getElementsByName("endDate")[0].value,
          reason: document.getElementsByName("reason")[0].value,
          status: "Pending",
        };
        if (!validate(vac)) {
          return;
        }

        if (localStorage.getItem("vacations") == null) {
          localStorage.setItem("vacations", "[]");
        }
        var vacs = JSON.parse(localStorage.getItem("vacations"));

        vacs[vacs.length] = vac;
        localStorage.setItem("vacations", JSON.stringify(vacs));

        window.location.href = "vacationList.html";
      }
    </script>
  </head>
  <body>
    <nav>
      <a href="index.html" class="logo">FCAI HR</a>
      <ul>
        <li>
          <a href="index.html"><b>Home</b></a>
        </li>
        <li>
          <a href="aboutUs.html"><b>About Us</b></a>
        </li>
        <li>
          <a href="vacationList.html"><b>Vacation List</b></a>
        </li>
      </ul>
    </nav>

    
    <div class="transition">
      <div>
        <h1>Apply for Vacation</h1>
        <form class="vform">
          <div class="vform-top">
            <label for="empID">ID</label>
            <input
              class="field"
              type="number"
              id="empID"
              name="empID"
              required="true"
            />

            <label for="empName">Full Name</label>
            <input class="field" type="text" name="name" id="empName" />
          </div>
          <script>
            let vacid = localStorage.getItem("vacid");
            let vacname = localStorage.getItem("vacname");
            if (vacid != null && vacname != null) {
              document.getElementById("empID").value = vacid;
              document.getElementById("empName").value = vacname;
              document.getElementById("empID").disabled = true;
              document.getElementById("empName").disabled = true;
            }
          </script>

          <div class="vform-mid">
            <div class="form-half date">
              <label>Starting Date</label>
              <input class="field" type="date" name="beginDate" />

              <label>Ending Date</label>
              <input class="field" type="date" name="endDate" />
            </div>

            <div class="form-half reason">
              <label>Reason</label>
              <textarea
                class="field"
                rows="5"
                cols="30"
                name="reason"
              ></textarea>
            </div>
          </div>

          <div class="input-part">
            <input
              type="button"
              class="abutton"
              value="Submit Request"
              onclick="submitVacForm()"
            />
            <input
              type="button"
              class="abutton"
              value="Cancel"
              onclick="window.location.href = 'index.html'"
            />
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
